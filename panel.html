<!doctype html>
<html lang="cs">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>LiveHub ‚Äì Admin Panel</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
  :root{--bg:#0d1117;--card:#111827;--muted:#9aa3af;--line:#1f2937;--accent:#2aa7ff}
  body{margin:0;background:var(--bg);color:#e6eef6;font-family:Inter,Arial}
  .wrap{max-width:880px;margin:28px auto;padding:0 16px}
  .panel{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:18px 16px}
  h1{margin:0 0 4px 0} .sub{color:var(--muted);margin-bottom:16px}
  input,select{width:100%;padding:10px 12px;border-radius:10px;border:1px solid var(--line);background:#0f1622;color:#e6eef6}
  label{font-size:14px;color:var(--muted);margin:8px 0 6px;display:block}
  .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  .btn{background:var(--accent);color:#001018;border:none;border-radius:10px;padding:10px 14px;font-weight:700;cursor:pointer}
  .ghost{background:transparent;border:1px solid var(--line);border-radius:10px;color:var(--muted);padding:10px 12px;cursor:pointer}
  .list .item{background:#0f1622;border:1px solid var(--line);border-radius:12px;padding:12px;margin-top:12px;display:flex;gap:12px;align-items:center}
  .grow{flex:1} .muted{color:var(--muted);font-size:13px}
  .pill{background:#10273a;color:#9bd3ff;padding:4px 8px;border-radius:999px;font-size:12px;margin-left:6px}
  .controls button{margin-left:6px}
  .login{display:flex;gap:8px;margin-top:10px}
</style>
</head>
<body>
<div class="wrap">
  <div class="panel">
    <h1>Admin Panel</h1>
    <div class="sub">Spr√°va p≈ôenos≈Ø</div>

    <!-- Login box -->
    <div id="authBox">
      <label>Email</label><input id="email" type="email" placeholder="admin@domena.cz">
      <label>Heslo</label><input id="password" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
      <div class="login">
        <button class="btn" id="btnLogin">P≈ôihl√°sit</button>
      </div>
    </div>

    <!-- Tools -->
    <div id="tools" style="display:none">
      <div class="row">
        <div>
          <label>N√°zev z√°pasu</label>
          <input id="title" placeholder="Nap≈ô. HC Vla≈°im vs Bene≈°ov">
        </div>
        <div>
          <label>Poskytovatel / kan√°l</label>
          <input id="provider" placeholder="O2 TV / ƒåT Sport">
        </div>
      </div>

      <div class="row">
        <div>
          <label>ƒåas zaƒç√°tku (nap≈ô. 17:30)</label>
          <input id="start" placeholder="17:30">
        </div>
        <div>
          <label>Kategorie</label>
          <select id="category">
            <option value="hokej">Hokej</option>
            <option value="fotbal">Fotbal</option>
            <option value="basket">Basketbal</option>
            <option value="ostatni">Ostatn√≠</option>
          </select>
        </div>
      </div>

      <label>Thumbnail (URL obr√°zku)</label>
      <input id="thumb" placeholder="https://.../thumb.jpg">

      <label>Odkaz na p≈ôenos (.m3u8 / .mp4 / embed)</label>
      <input id="src" placeholder="https://.../stream.m3u8">

      <div style="display:flex;gap:8px;margin-top:12px">
        <button class="btn" id="btnSave">P≈ôidat p≈ôenos</button>
        <button class="ghost" id="btnLogout">Odhl√°sit</button>
      </div>

      <div style="margin-top:16px;display:flex;justify-content:space-between;align-items:center">
        <div style="font-weight:700">Seznam p≈ôenos≈Ø</div>
        <button class="ghost" id="btnResequence">P≈ôeƒç√≠slovat po≈ôad√≠</button>
      </div>

      <div id="list" class="list"></div>
    </div>
  </div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
  import { getFirestore, collection, addDoc, doc, updateDoc, deleteDoc, onSnapshot, query, orderBy, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore.js";
  import { getAuth, onAuthStateChanged, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-auth.js";

  // üîß stejn√© config jako v index.html
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_PROJECT.firebaseapp.com",
    projectId: "YOUR_PROJECT",
    storageBucket: "YOUR_PROJECT.appspot.com",
    messagingSenderId: "SENDER_ID",
    appId: "APP_ID"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const auth = getAuth(app);
  const $ = id=>document.getElementById(id);

  onAuthStateChanged(auth, user=>{
    if(user){ $("authBox").style.display="none"; $("tools").style.display="block"; }
    else { $("authBox").style.display="block"; $("tools").style.display="none"; }
  });

  $("btnLogin").onclick = async ()=>{
    try{ await signInWithEmailAndPassword(auth, $("email").value, $("password").value); }
    catch(e){ alert("P≈ôihl√°≈°en√≠ selhalo: "+e.message); }
  };
  $("btnLogout").onclick = ()=> signOut(auth);

  $("btnSave").onclick = async ()=>{
    const data = {
      title: $("title").value.trim(),
      provider: $("provider").value.trim(),
      start: $("start").value.trim(),
      src: $("src").value.trim(),
      thumb: $("thumb").value.trim(),
      category: $("category").value,
      order: Date.now(),
      createdAt: serverTimestamp()
    };
    if(!data.title || !data.src){ alert("Vypl≈àte alespo≈à N√°zev a Odkaz."); return; }
    await addDoc(collection(db,"streams"), data);
    ["title","provider","start","src","thumb"].forEach(id=>$(id).value="");
    alert("Ulo≈æeno");
  };

  const qStreams = query(collection(db,"streams"), orderBy("order","asc"));
  onSnapshot(qStreams, snap=>{
    const list = $("list");
    if(snap.empty){ list.innerHTML = `<div class="muted">≈Ω√°dn√© polo≈æky</div>`; return; }
    list.innerHTML="";
    snap.forEach(docu=>{
      const d = docu.data();
      const li = document.createElement("div");
      li.className="item";
      li.innerHTML=`
        <div class="grow">
          <div style="font-weight:700">${escapeHtml(d.title)} <span class="pill">${escapeHtml(d.category||"")}</span></div>
          <div class="muted">${escapeHtml(d.provider||"")} ${d.start?("‚Ä¢ "+d.start):""}</div>
          ${d.thumb?`<img src="${d.thumb}" style="max-width:200px;border-radius:8px;margin-top:6px;">`:""}
          <div class="muted" style="word-break:break-all">${escapeHtml(d.src)}</div>
        </div>
        <div class="controls">
          <button class="ghost" data-act="delete">Smazat</button>
        </div>`;
      li.querySelector('[data-act="delete"]').onclick = ()=> deleteDoc(doc(db,"streams",docu.id));
      list.appendChild(li);
    });
  });

  const escapeHtml=s=>String(s||'').replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;'}[m]));
</script>
</body>
</html>
